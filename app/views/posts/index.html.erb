<p id="notice"><%= notice %></p>

<h1 style="text-align:center;">Posts</h1>


<%= render 'form', post: @post %>

<% @posts.to_a.reverse.each do |post| %>
  <div class="card" style="width: 30rem;">
    <div class="card-body">

      <% if post.user.avatar.attached? %>
        <h5 class="card-title"><p><br><%= image_tag post.user.avatar.variant(resize: "50x50").processed %>
      <% end %> </p></h5>

      <h6 class="card-subtitle mb-2 text-muted"><i><%= simple_format(post.updated_at.to_s.slice(0, 10)) %></i></h6>
      <p class="card-text" id="card-text-<%= post.id %>"><%= post.message %></p>

      <div id="edit-post-<%= post.id %>" class="edit-options">

        <%= form_with model: @post, url: "/posts/#{post.id}/", method: :patch, local: true do |form| %>
          <p>
            <%= form.text_area :message, value: post.message, size: "34x5" %>
          </p>
          <p>
            <%= form.submit "Update" %>
          </p>
        <% end %>

      </div>

      <%= link_to "Actions", "#", class: "actions-button", id: "action-button-#{post.id}" %>

      <div id="post-options-<%= post.id %>" class="post-options">
        <%= link_to 'Show', post, class: "card-link" %>

        <% if post.user.id == current_user.id %>
          <%= link_to "Edit", "#", class: "edit-button", id: "edit-button-#{post.id}" %>
          <%= link_to 'Destroy', post, method: :delete, data: {confirm: 'Are you sure?'}, class: "card-link" %>
        <% end %>

        <%= form_with model: @comments, url: '/posts/' + post.id.to_s + '/comments', method: "post",  local: true do |form| %>
          <div class="input-group mb-3">
            <%= form.text_field :message, placeholder: "Type a comment", class: "form-control", id: "message_body" %>
            <% p params %>
            <div class="input-group-append">
              <%= form.submit "Send", class: "btn btn-secondary" %>
            </div>
          </div>
        <% end %>



        <% post.comments.to_a.reverse.each do |comment| %>
          <% p comment %>
          <p class="card-text"><%= simple_format(comment.message) %></p>
          <p class="card-text"><%= simple_format(comment.email) %></p>
        <% end %>



      </div>

    </div>
  </div>

<% end %>

<br>

<%= link_to 'New Post', new_post_path %>
